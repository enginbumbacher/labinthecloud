<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Euglena Modeling</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      /* https://projects.lukehaas.me/css-loaders/ */
      .loader,
      .loader:before,
      .loader:after {
        border-radius: 50%;
        width: 2.5em;
        height: 2.5em;
        -webkit-animation-fill-mode: both;
        animation-fill-mode: both;
        -webkit-animation: load7 1.8s infinite ease-in-out;
        animation: load7 1.8s infinite ease-in-out;
      }
      .loader {
        color: #000000;
        font-size: 10px;
        margin: 80px auto;
        position: relative;
        text-indent: -9999em;
        -webkit-transform: translateZ(0);
        -ms-transform: translateZ(0);
        transform: translateZ(0);
        -webkit-animation-delay: -0.16s;
        animation-delay: -0.16s;
      }
      .loader:before,
      .loader:after {
        content: '';
        position: absolute;
        top: 0;
      }
      .loader:before {
        left: -3.5em;
        -webkit-animation-delay: -0.32s;
        animation-delay: -0.32s;
      }
      .loader:after {
        left: 3.5em;
      }
      @-webkit-keyframes .loader {
        0%,
        80%,
        100% {
          box-shadow: 0 2.5em 0 -1.3em;
        }
        40% {
          box-shadow: 0 2.5em 0 0;
        }
      }
      @keyframes load7 {
        0%,
        80%,
        100% {
          box-shadow: 0 2.5em 0 -1.3em;
        }
        40% {
          box-shadow: 0 2.5em 0 0;
        }
      }
    </style>
  </head>
  <body>
    <xml xmlns="http://www.w3.org/1999/xhtml" id="toolbox" style="display: none;">
      <category name="Turning" colour="#2F5596">
          <block type="turn_at_1sensor" id="turn_at_1sensor" disabled='false' max_use='2' sensors='one' equivalence='turn_at_2sensors'>
          <field name="DIRECTION">TOWARDS</field>
        </block>
        <block type="turn_at_2sensors" id="turn_at_2sensors" disabled='false' max_use='2' sensors='two' equivalence='turn_at_1sensor'>
          <field name="DIRECTION">TOWARDS</field>
        </block>
        <block type="turn_randomly" id="turn_randomly" disabled='false' max_use='2' sensors='both'></block>
        <block type="turn_change" id='turn_change' disabled='false' max_use='2' sensors='both'>
          <field name="SPEED">CHANGE_20</field>
        </block>
      </category>
      <category name="Forward" colour="#805ba5">
        <block type="move_normal" id="move_normal" disabled='false' max_use='2' sensors='both'></block>
        <block type="move_change" id='move_change' disabled='false' max_use='2' sensors='both'>
          <field name="SPEED">CHANGE_20</field>
        </block>
      </category>
      <category name="Rotation" colour="#C55A11">
        <block type="roll_normal" id="roll_normal" disabled='false' max_use='2' sensors='both'></block>
        <block type="roll_change" id='roll_change' disabled='false' max_use='2' sensors='both'>
          <field name="SPEED">CHANGE_20</field>
        </block>
      </category>
      <category name="Additional Blocks" colour="#00A407">
        <block class='sensing' type="see_light_quantity" id="see_light_quantity" disabled='false' max_use='2' sensors='both'>
          <field name='THRESHOLD'>THRESH_20</field>
        </block>
      </category>
    </xml>
    <xml xmlns="http://www.w3.org/1999/xhtml" id="defaultWorkspaceBlocks" style="display:none">
      <variables></variables>
      <block type="master_block" id="master_block" x="5" y="63" max_use='0' sensors='both'>
        <statement name="CODE">
          <block class='sensing' type="either_way" id="either_way" max_use='0' sensors='both'>
            <next>
              <block class='sensing' type="no_light" id="no_light" max_use='0' sensors='both'>
                <next>
                  <block class='sensing' type="see_light" id="see_light" max_use='0' sensors='both'></block>
                </next>
              </block>
            </next>
          </block>
        </statement>
      </block>
    </xml>
    <div class="loader">Loading..</div>
    <script src="/cslib/thirdparty/blockly/blockly_compressed.js"></script>
    <script src="/cslib/thirdparty/blockly/blocks_compressed.js"></script>
    <script src="/cslib/thirdparty/blockly/javascript_compressed.js"></script>
    <script src="/cslib/thirdparty/blockly/msg/js/en.js"></script>
    <script src="/cslib/module/euglena/model_blockly/blocklytab/modeling_blocks.js"></script>

    <script type="text/javascript">
      window.EuglenaConfig = {
        lab: "2_pf_body_1",
        system: {
          maxLoginTime: 0,
          experimentModality: 'create', // 'observe','explore','create', 'createAndHistory'
          modelModality: 'create', // 'observe','explore','create'
          expModelModality: 'justmodel', //'simultaneous','sequential', 'justmodel' - for seeing model and live not together
          enableDirectComparison: false, // false: cannot do direct comparison between models
          testMaterial: true
        },
        experiment: {
          server: "dev",
          experimentForm: 'narrative', // 'table', 'narrative'
          maxDuration: 60,
          // bpuId: "eug16", //["eug5","eug7"], //"eug1","eug4","eug5","eug6","eug7","eug8","eug15","eug16"
          euglenaServerMode:"historical", // 'simulate', 'demo', 'historical'
          formOptions: ['no_light','complex_seq'], // Decide, which experiment categories are available; if empty: all; Options: 'no_light', 'fix_dir', 'simple_seq', 'complex_seq'
          experimentHistory: [12]
        },
        model: {
          modelName: "Body Components",
          //modelHistory: [1305,1311],
          tabs: [{
            modelType: "mech",
            modelForm: 'mechanistic', // 'mechanistic' or 'functional'
            parameterForm: 'quantitative', //'qualitative' or 'quantitative'
            variationLimitation: null, //'fixVar_PERCENTAGE' - variation fixed, no variation if PERCENTAGE = 0, null (variation possible)
            color: 0xff0000,
            regionNames: {
              sensor: {label: 'Sensor Geometry', color: [192,0,0]},
              motor: {label: 'Flagellum Motion', color: [112,48,160]},
              settings: {label: 'Model Settings', color: [184,184,184]}
              //order: ['sensor','motor','settings']
            },
            parameters: {
              sensorType: {
                region: 'sensor',
                label: "Sensor Type",
                color: '#C00000',
                initialValue: "type_1side",
                min_width: '210px',
                options: {'type_1side': 'One sensor on side', 'type_2sensors': '2 sensors'},
                description: 'Select different types for the light sensor. You can change location and number of sensors.'
              },
              // sensorPosition: {
              //   region: 'sensor',
              //   label: "Sensor Distance",
              //   color: '#C00000',
              //   initialValue: "position_0",
              //   min_width: '210px',
              //   options: {'position_0':'close', 'position_100': 'far'},
              //   description: 'Select the distance from the sensor to the flagellum.'
              // },
              // sensorShape: {
              //   region: 'sensor',
              //   label: "Field of View",
              //   color: '#C00000',
              //   initialValue: "shape_50",
              //   min_width: '210px',
              //   options: {'shape_50':'half', 'shape_100': 'full'},
              //   description: 'Write text.'
              // },
              /*opacity: {
                region: 'body',
                label: "Body Opacity",
                color: '#759364',
                initialValue: 'opacity_20',
                maxValue: 1.0,

              },*/
              v: {
                region: 'motor',
                label: "Forward Speed <br> [micrometers / second]", // If mechanistic: "Motor Strength", if functional: "Motor Speed"
                color: '#7030A0',
                initialValue: {base: 90, delta: 20}, //'motor_25',
                min_width: '130px',
                maxValue: 2,
                varOptions: {'variation_0': 'no', 'variation_10': 'small', 'variation_25': 'medium', 'variation_50': 'large'},
                options: {'motor_25': 'weak', 'motor_50': 'medium', 'motor_75': 'fast'},
                description: 'Set the speed at which the model moves forward when not reacting to light.',
                min: 25,
                max: 200,
                steps: 35
                // If mechanistic: {'motor_25': 'weak', 'motor_50': 'medium', 'motor_75': 'strong', 'motor_100': 'very strong'}
                // If functional: {'motor_25': 'slow', 'motor_50': 'medium', 'motor_75': 'fast', 'motor_100': 'very fast'}
              },
              roll: {
                region: 'motor',
                label: "Rotation Speed <br> [rotations / second]", // If mechanistic: "Roll Strength", if functional: "Roll Speed"
                color: '#7030A0',
                initialValue: {base: 1.4, delta: 1}, //'motor_25',
                min_width: '130px',
                maxValue: 3,
                varOptions: {'variation_0': 'no', 'variation_10': 'small', 'variation_25': 'medium', 'variation_50': 'large'},
                options: {'roll_0': 'no rotation', 'roll_25': 'slow', 'roll_50': 'medium', 'roll_75': 'fast'},
                description: 'Set the speed at which the model rotates around its long body axis when moving forward.',
                min: 0,
                max: 3,
                steps: 15
                // If mechanistic: {'motor_25': 'weak', 'motor_50': 'medium', 'motor_75': 'strong', 'motor_100': 'very strong'}
                // If functional: {'motor_25': 'slow', 'motor_50': 'medium', 'motor_75': 'fast', 'motor_100': 'very fast'}
              }
            }
          }],
          euglenaCount: {
            range: [10, 50],
            options: {1:1, 2:2, 5:5, 10:10, 20:20},
            initialValue: 5,
            region: 'settings',
          },
          euglenaInit: {
            options: {"1": 'random', "2": 'all point to right', "3": 'all point downwards', "4": 'all point to the left', "5": 'all point upwards'},
            initialValue: "1",
            region: 'settings',
          },
          simulationFps: 9
        },
        visualization: {
           visualizationTypes: [{
             id: "circle",
             label: "Cake Visualization",
             settings: {
               binCount: 12, //15° bins
               dT: 1, // in seconds; indicates time window for binning
               tStep: 0.5, // in seconds, i.e. tStep = 0.5 --> Half a second; indicates time at which graph steps forward
               width: 320,
               height: 320
             }
           },
           {
              id: "timeseries",
              label: "Forward Speed",
              settings: {
                vRange: null,
                mode: 'total',
                stdBand: true,
                dT: 1,

                width: 500,
                height: 400
              }
            }, {
              id: "componentspeed",
              label: "Up/Down and Left/Right Speed",
              settings: {
                vRange: null,
                mode: 'component',
                stdBand: true,
                dT: 1,

                width: 450,
                height: 250
              }
            }
          ]
        },
        modeling: {
         timeWindow: 2,
         regionNames: {
           signalActivate: {label: '1. Photoreceptors release Signal Molecules', color: [192,0,0]},
           signalProcessing: {label: '2. Signal Molecules open Calcium channels', color: [14,137,209]},
           behavior: {label: '3. Calcium particles change Flagellum movement', color: [112,48,160]}
         },
         variationLimitation: null, //'fixVar_PERCENTAGE' - variation fixed, no variation if PERCENTAGE = 0, null (variation possible),
         explanationOn: false,
         mechanism: 'complex', // 'simple','complex'
         parameters: {
           signalThresh: { //SymSelectField
             region: 'signalActivate',
             label: "Activation Brightness <br> [in % of maximum brightness]",
             color: '#C55A11',
             initialValue: {base: 20, delta: 0}, //'signal_2',
             min: 0,
             max: 100,
             steps: 20,
             min_width: '210px',
             maxValue: 1, //This value is also in percent of brightness
             varOptions: {'variation_0': 'no', 'variation_10': 'small', 'variation_25': 'medium', 'variation_50': 'large'},
             options: {'signal_2': 'very low', 'signal_25': 'low', 'signal_50': 'medium', 'signal_75': 'high', 'signal_100': 'very high'},
             description: 'Set the amount of calcium particle inflow in response to channels opening.'
           },
           signalAdapt: { //SelectField // Mode of adaptation
             region: 'signalActivate',
             label: "Adaptation of Activation Brightness?",
             color: '#C55A11',
             initialValue: 'adapt_continuous',
             min_width: '210px',
             options: { 'adapt_0': 'No' , 'adapt_shock': 'Yes'},
             description: 'Decide whether or not to adapt the level of activation to the general brightness.'
           },
           signalAdaptSpeed: { //SymSelectField
             region: 'signalActivate',
             label: "Adaptation Speed <br> [in seconds]",
             color: '#C55A11',
             min_width: '210px',
             initialValue: {base: 5, delta: 0}, //'speed_25',
             min: 0,
             max: 60,
             steps: 60,
             maxValue: 100, //This value is also in percent of brightness
             varOptions: {'variation_0': 'no', 'variation_10': 'small', 'variation_25': 'medium', 'variation_50': 'large'},
             options: {'speed_2': 'very slowly', 'speed_25': 'slowly', 'speed_50': 'at medium speed', 'speed_75': 'quickly', 'speed_100': 'very quickly'},
             description: 'Set the speed (in seconds) at which the receptors adapt to the background light.'
           },
           channelOpeningAmount: { //SelectField
             region: 'signalProcessing',
             label: "How many channels?",
             color: '#0e89d1',
             initialValue: 'amount_proportional',
             min_width: '210px',
             options: {'amount_constant': 'all or none', 'amount_proportional': 'proportional to number of Signal Mol.'},
             description: 'Set the way it will turn when activated by a signal molecule.'
           },
           reactionStrength: { //SymSelectField
             region: 'signalProcessing',
             label: 'Amount of Calcium Particle Inflow Channel <br> [in thousands]',
             color: '#0e89d1',
             initialValue: {base: 2, delta: 0.5}, //'reaction_25',
             min: 0,
             max: 10,
             steps: 20,
             maxValue: 10,
             varOptions: {'variation_0': 'no', 'variation_10': 'small', 'variation_25': 'medium', 'variation_50': 'large'},
             options: {'turn_25': 'slow', 'turn_50': 'medium', 'turn_75': 'fast'},
             description: 'Set the amount of calcium particle inflow in response to channels opening.'
           },
           turnForward: { //SelectField
             region: 'behavior',
             label: 'How will it turn?',
             color: '#7030A0',
             initialValue: 'forward_0',
             min_width: '210px',
             options: {'forward_0': 'Flagellum beats in one direction, stops spiraling', 'forward_1': 'Flagellum tilts in one direction, continues spiraling'},
             description: 'Changing this parameter changes how the Flagellum moves.'
           }
         }
        }

      };
    </script>
    <!-- <script data-main="./cslib/init" src="./cslib/thirdparty/require/require.js"></script> -->
    <script src="../cslib/litc-main.js"></script>
  </body>
</html>

<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Euglena Modeling</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      /* https://projects.lukehaas.me/css-loaders/ */
      .loader,
      .loader:before,
      .loader:after {
        border-radius: 50%;
        width: 2.5em;
        height: 2.5em;
        -webkit-animation-fill-mode: both;
        animation-fill-mode: both;
        -webkit-animation: load7 1.8s infinite ease-in-out;
        animation: load7 1.8s infinite ease-in-out;
      }
      .loader {
        color: #000000;
        font-size: 10px;
        margin: 80px auto;
        position: relative;
        text-indent: -9999em;
        -webkit-transform: translateZ(0);
        -ms-transform: translateZ(0);
        transform: translateZ(0);
        -webkit-animation-delay: -0.16s;
        animation-delay: -0.16s;
      }
      .loader:before,
      .loader:after {
        content: '';
        position: absolute;
        top: 0;
      }
      .loader:before {
        left: -3.5em;
        -webkit-animation-delay: -0.32s;
        animation-delay: -0.32s;
      }
      .loader:after {
        left: 3.5em;
      }
      @-webkit-keyframes .loader {
        0%,
        80%,
        100% {
          box-shadow: 0 2.5em 0 -1.3em;
        }
        40% {
          box-shadow: 0 2.5em 0 0;
        }
      }
      @keyframes load7 {
        0%,
        80%,
        100% {
          box-shadow: 0 2.5em 0 -1.3em;
        }
        40% {
          box-shadow: 0 2.5em 0 0;
        }
      }
    </style>
  </head>
  <body>
    <xml xmlns="http://www.w3.org/1999/xhtml" id="toolbox" style="display: none;">
      <category name="Turning" colour="#2F5596">
          <block type="turn_at_1sensor_eyespot" id="turn_at_1sensor_eyespot" disabled='false' max_use='2' sensors='one' equivalence='turn_at_2sensors'>
          <field name="DIRECTION">TOWARDS</field>
        </block>
        <block type="turn_at_2sensors" id="turn_at_2sensors" disabled='false' max_use='2' sensors='two' equivalence='turn_at_1sensor'>
          <field name="DIRECTION">TOWARDS</field>
        </block>
        <block type="turn_randomly" id="turn_randomly" disabled='false' max_use='2' sensors='both'></block>
        <block type="turn_change" id='turn_change' disabled='false' max_use='2' sensors='both'>
          <field name="SPEED">CHANGE_20</field>
        </block>
      </category>
      <category name="Forward" colour="#805ba5">
        <block type="move_normal" id="move_normal" disabled='false' max_use='2' sensors='both'></block>
        <block type="move_change" id='move_change' disabled='false' max_use='2' sensors='both'>
          <field name="SPEED">CHANGE_20</field>
        </block>
      </category>
      <category name="Rotation" colour="#C55A11">
        <block type="roll_normal" id="roll_normal" disabled='false' max_use='2' sensors='both'></block>
        <block type="roll_change" id='roll_change' disabled='false' max_use='2' sensors='both'>
          <field name="SPEED">CHANGE_20</field>
        </block>
      </category>
      <category name="Additional Blocks" colour="#00A407">
        <block class='sensing' type="see_light_quantity" id="see_light_quantity" disabled='false' max_use='2' sensors='both'>
          <field name='THRESHOLD'>THRESH_20</field>
        </block>
      </category>
    </xml>
    <xml xmlns="http://www.w3.org/1999/xhtml" id="defaultWorkspaceBlocks" style="display:none">
      <variables></variables>
      <block type="master_block" id="master_block" x="5" y="63" max_use='0' sensors='both'>
        <statement name="CODE">
          <block class='sensing' type="either_way" id="either_way" max_use='0' sensors='both'>
            <next>
              <block class='sensing' type="no_light" id="no_light" max_use='0' sensors='both'>
                <next>
                  <block class='sensing' type="see_light" id="see_light" max_use='0' sensors='both'></block>
                </next>
              </block>
            </next>
          </block>
        </statement>
      </block>
    </xml>
    <div class="loader">Loading..</div>
    <script src="/cslib/thirdparty/blockly/blockly_compressed.js"></script>
    <script src="/cslib/thirdparty/blockly/blocks_compressed.js"></script>
    <script src="/cslib/thirdparty/blockly/javascript_compressed.js"></script>
    <script src="/cslib/thirdparty/blockly/msg/js/en.js"></script>
    <script src="/cslib/module/euglena/model_blockly/blocklytab/modeling_blocks.js"></script>

    <script type="text/javascript">
      window.EuglenaConfig = {
        lab: "2_pf_body_1",
        system: {
          maxLoginTime: 0,
          experimentModality: 'create', // 'observe','explore','create', 'createAndHistory'
          modelModality: 'create', // 'observe','explore','create'
          expModelModality: 'simultaneous', //'simultaneous','sequential', 'justmodel' - for seeing model and live not together
          enableDirectComparison: false, // false: cannot do direct comparison between models
        },
        experiment: {
          server: "dev",
          experimentForm: 'narrative', // 'table', 'narrative'
          maxDuration: 60,
          // bpuId: "eug16", //["eug5","eug7"], //"eug1","eug4","eug5","eug6","eug7","eug8","eug15","eug16"
          euglenaServerMode:"historical", // 'simulate', 'demo', 'historical'
          formOptions: ['no_light','complex_seq'], // Decide, which experiment categories are available; if empty: all; Options: 'no_light', 'fix_dir', 'simple_seq', 'complex_seq'
          experimentHistory: [603,604,607]
        },
        model: {
          modelName: "Body Components",
          //modelHistory: [1305,1311],
          tabs: [{
            modelType: "blockly",
            modelForm: 'mechanistic', // 'mechanistic' or 'functional'
            parameterForm: 'qualitative', //'qualitative' or 'quantitative'
            variationLimitation: null, //'fixVar_PERCENTAGE' - variation fixed, no variation if PERCENTAGE = 0, null (variation possible)
            color: 0x2222ff,
            regionNames: {
              sensor: {label: 'Sensor Geometry', color: [192,0,0]},
              motor: {label: 'Flagellum Motion', color: [112,48,160]},
              settings: {label: 'Model Settings', color: [184,184,184]}
              //order: ['sensor','motor','settings']
            },
            parameters: {
              sensorType: {
                region: 'sensor',
                label: "Sensor Type",
                color: '#C00000',
                initialValue: "type_1side",
                min_width: '210px',
                options: {'type_1side': 'One sensor on side', 'type_2sensors': '2 sensors', 'type_eyespot': 'One sensor in middle with light block'},
                description: 'Select different types for the light sensor. You can change location and number of sensors.'
              },
              // sensorPosition: {
              //   region: 'sensor',
              //   label: "Sensor Distance",
              //   color: '#C00000',
              //   initialValue: "position_0",
              //   min_width: '210px',
              //   options: {'position_0':'close', 'position_100': 'far'},
              //   description: 'Select the distance from the sensor to the flagellum.'
              // },
              // sensorShape: {
              //   region: 'sensor',
              //   label: "Field of View",
              //   color: '#C00000',
              //   initialValue: "shape_50",
              //   min_width: '210px',
              //   options: {'shape_50':'half', 'shape_100': 'full'},
              //   description: 'Write text.'
              // },
              /*opacity: {
                region: 'body',
                label: "Body Opacity",
                color: '#759364',
                initialValue: 'opacity_20',
                maxValue: 1.0,

              },*/
              v: {
                label: "Forward Speed", // If mechanistic: "Motor Strength", if functional: "Motor Speed"
                region: 'motor',
                color: '#7030A0',
                initialValue: 'motor_25',
                maxValue: 10,
                varOptions: {},//{'variation_0': 'no', 'variation_10': 'small', 'variation_25': 'medium', 'variation_50': 'large'},
                options: {'motor_25': 'slow', 'motor_50': 'medium', 'motor_75': 'fast'},
                description: 'Set the speed at which the model moves forward, if it is programmed to move. The percentage refers to the maximum possible intensity for any model. See how the red arrow changes when you change the value.'
                // If mechanistic: {'motor_25': 'weak', 'motor_50': 'medium', 'motor_75': 'strong', 'motor_100': 'very strong'}
                // If functional: {'motor_25': 'slow', 'motor_50': 'medium', 'motor_75': 'fast', 'motor_100': 'very fast'}
              },
              roll: {
                region: 'motor',
                label: "Rotation speed", // If mechanistic: "Roll Strength", if functional: "Roll Speed"
                color: '#7030A0',
                initialValue: 'roll_0',
                maxValue: 6,
                varOptions: {},//{'variation_0': 'no', 'variation_10': 'small', 'variation_25': 'medium', 'variation_50': 'large'},
                options: {'roll_0': 'no rotation', 'roll_25': 'slow', 'roll_50': 'medium', 'roll_75': 'fast'},
                description: 'Set the speed at which the model rotates around its long body axis normally, if it is programmed to rotate. The percentage refers to the maximum possible intensity for any model. See how the orange arrow changes when you change the value.'
                // If mechanistic: {'roll_25': 'weak', 'roll_50': 'medium', 'roll_75': 'strong', 'roll_100': 'very strong'}
                // If functional: {'roll_25': 'slow', 'roll_50': 'medium', 'roll_75': 'fast', 'roll_100': 'very fast'}
              }
            }
          }],
          euglenaCount: {
            range: [10, 50],
            options: {1:1, 2:2, 5:5, 10:10, 20:20},
            initialValue: 5,
            region: 'settings',
          },
          euglenaInit: {
            options: {"1": 'random', "2": 'all point to right', "3": 'all point downwards', "4": 'all point to the left', "5": 'all point upwards'},
            initialValue: "1",
            region: 'settings',
          },
          simulationFps: 9
        },
        visualization: {
           visualizationTypes: [{
             id: "circle",
             label: "Cake Visualization",
             settings: {
               binCount: 12, //15° bins
               dT: 1, // in seconds; indicates time window for binning
               tStep: 0.5, // in seconds, i.e. tStep = 0.5 --> Half a second; indicates time at which graph steps forward
               width: 320,
               height: 320
             }
           },
           {
              id: "timeseries",
              label: "Forward Speed",
              settings: {
                vRange: null,
                mode: 'total',
                stdBand: true,
                dT: 1,

                width: 500,
                height: 400
              }
            }
          ]
        },
        modeling: {
         timeWindow: 2,
         regionNames: {
           signalActivate: {label: '1. Photoreceptors release Signal Molecules', color: [192,0,0]},
           signalProcessing: {label: '2. Signal Molecules open Calcium channels', color: [14,137,209]},
           behavior: {label: '3. Calcium particles change Flagellum movement', color: [112,48,160]}
         },
         variationLimitation: null, //'fixVar_PERCENTAGE' - variation fixed, no variation if PERCENTAGE = 0, null (variation possible),
         explanationOn: false,
         mechanism: 'complex', // 'simple','complex'
         parameters: {
           signalThresh: { //SymSelectField
             region: 'signalActivate',
             label: "Activation Brightness",
             color: '#C55A11',
             initialValue: 'signal_2',//{base: 20, delta: 5},
             min: 0,
             max: 100,
             steps: 20,
             min_width: '210px',
             maxValue: 1, //This value is also in percent of brightness
             varOptions: {'variation_0': 'no', 'variation_10': 'small', 'variation_25': 'medium', 'variation_50': 'large'},
             options: {'signal_2': 'very low', 'signal_25': 'low', 'signal_50': 'medium', 'signal_75': 'high', 'signal_100': 'very high'},
             description: 'Set the amount of calcium particle inflow in response to channels opening.'
           },
           channelOpeningAmount: { //SelectField
             region: 'signalProcessing',
             label: "Amount of channels opening up",
             color: '#0e89d1',
             initialValue: 'amount_proportional',
             min_width: '210px',
             options: {'amount_constant': 'all or none', 'amount_proportional': 'proportional to num. of Signal Molecules'},
             description: 'Set the way it will turn when activated by a signal molecule.'
           },
           turnForward: { //SelectField
             region: 'behavior',
             label: 'How will it turn?',
             color: '#7030A0',
             initialValue: 'forward_0',
             min_width: '210px',
             options: {'forward_1': 'Flagellum tilts in one direction, continues spiraling', 'forward_0': 'Flagellum beats in one direction, continues spiraling'},
             description: 'Changing this parameter changes how the Flagellum moves.'
           }
         }
        }
      };
    </script>
    <!-- <script data-main="./cslib/init" src="./cslib/thirdparty/require/require.js"></script> -->
    <script src="../cslib/litc-main.js"></script>
  </body>
</html>
